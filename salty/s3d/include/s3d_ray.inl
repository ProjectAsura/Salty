//------------------------------------------------------------------------------
// File : s3d_ray.inl
// Desc : Ray Module.
// Copyright(c) Project Asura. All right reserved.
//------------------------------------------------------------------------------

#ifndef __S3D_RAY_INL__
#define __S3D_RAY_INL__

namespace s3d {

////////////////////////////////////////////////////////////////////////////////
// Ray class
////////////////////////////////////////////////////////////////////////////////

//------------------------------------------------------------------------------
//      コンストラクタです.
//------------------------------------------------------------------------------
S3D_INLINE
Ray::Ray()
{ /* DO_NOTHING */ }

//------------------------------------------------------------------------------
//      引数付きコンストラクタです.
//------------------------------------------------------------------------------
S3D_INLINE
Ray::Ray( const Vector3& position, const Vector3& direction )
: pos( position )
{
    SetDir( direction );
}

//------------------------------------------------------------------------------
//      コピーコンストラクタです.
//------------------------------------------------------------------------------
S3D_INLINE
Ray::Ray( const Ray& value )
: pos( value.pos )
{
    SetDir( value.dir );
}

//------------------------------------------------------------------------------
//      位置を設定します.
//------------------------------------------------------------------------------
S3D_INLINE
void Ray::SetPos( const Vector3& value )
{ pos = value; }

//------------------------------------------------------------------------------
//      方向を設定します.
//------------------------------------------------------------------------------
S3D_INLINE
void Ray::SetDir( const Vector3& value )
{
    dir = value;

    invDir.x = 1.0 / value.x;
    invDir.y = 1.0 / value.y;
    invDir.z = 1.0 / value.z;

    signX = ( dir.x > 0.0 ) ? 0 : 1;
    signY = ( dir.y > 0.0 ) ? 0 : 1;
    signZ = ( dir.z > 0.0 ) ? 0 : 1;
}

//------------------------------------------------------------------------------
//      位置を取得します.
//------------------------------------------------------------------------------
S3D_INLINE
Vector3 Ray::GetPos() const
{ return pos; }

//------------------------------------------------------------------------------
//      方向を取得します.
//------------------------------------------------------------------------------
S3D_INLINE
Vector3 Ray::GetDir() const
{ return dir; }

//------------------------------------------------------------------------------
//      方向ベクトル各成分の逆数を取得します.
//------------------------------------------------------------------------------
S3D_INLINE
Vector3 Ray::GetInvDir() const
{ return invDir; }

//------------------------------------------------------------------------------
//      X成分の符号を取得します.
//------------------------------------------------------------------------------
S3D_INLINE
s32 Ray::GetSignX() const
{ return signX; }

//------------------------------------------------------------------------------
//      Y成分の符号を取得します.
//------------------------------------------------------------------------------
S3D_INLINE
s32 Ray::GetSignY() const
{ return signY; }

//------------------------------------------------------------------------------
//      Z成分の符号を取得します.
//------------------------------------------------------------------------------
S3D_INLINE
s32 Ray::GetSignZ() const
{ return signZ; }

//------------------------------------------------------------------------------
//      レイを進めます.
//------------------------------------------------------------------------------
S3D_INLINE
Vector3 Ray::Step( const f64 dist ) const
{ return pos + dir * dist; }

//------------------------------------------------------------------------------
//      代入演算子です.
//------------------------------------------------------------------------------
S3D_INLINE
Ray& Ray::operator = ( const Ray& value )
{
    pos    = value.pos;
    dir    = value.dir;
    invDir = value.invDir;
    signX  = value.signX;
    signY  = value.signY;
    signZ  = value.signZ;
    return (*this);
}

} // namespace s3d

#endif//__S3D_RAY_INL__
