//----------------------------------------------------------------------------------------
// File : s3d_mesh.h
// Desc : Mesh Module.
// Copyright(c) Project Asura. All right reserved.
//----------------------------------------------------------------------------------------

#ifndef __S3D_MESH_H__
#define __S3D_MESH_H__

//----------------------------------------------------------------------------------------
// Includes
//----------------------------------------------------------------------------------------
#include <s3d_math.h>
#include <s3d_shape.h>
#include <s3d_material.h>
#include <s3d_bvh.h>


namespace s3d {

/////////////////////////////////////////////////////////////////////////////////////////
// Mesh structure
/////////////////////////////////////////////////////////////////////////////////////////
class Mesh : public IShape
{
public:
    //==================================================================================
    // public variables.
    //==================================================================================
    /* NOTHING */

    //==================================================================================
    // public methods.
    //==================================================================================

    //----------------------------------------------------------------------------------
    //! @brief      コンストラクタです.
    //----------------------------------------------------------------------------------
    Mesh();

    //----------------------------------------------------------------------------------
    //! @brief      デストラクタです.
    //----------------------------------------------------------------------------------
    virtual ~Mesh();

    //----------------------------------------------------------------------------------
    //! @brief      ファイルからロードします.
    //----------------------------------------------------------------------------------
    bool LoadFromFile( const char* filename );

    //----------------------------------------------------------------------------------
    //! @brief      メモリ解放処理を行います.
    //----------------------------------------------------------------------------------
    void Release();

    //----------------------------------------------------------------------------------
    //! @brief      交差判定します.
    //----------------------------------------------------------------------------------
    bool IsHit(const Ray&, HitRecord&) const;

    //----------------------------------------------------------------------------------
    //! @brief      マテリアルを取得します.
    //----------------------------------------------------------------------------------
    const IMaterial* GetMaterial() const;

    //----------------------------------------------------------------------------------
    //! @brief      バウンディングボックスを取得します.
    //----------------------------------------------------------------------------------
    BoundingBox GetBox() const;

    //----------------------------------------------------------------------------------
    //! @brief      基本図形かどうか判定します.
    //----------------------------------------------------------------------------------
    bool IsPrimitive() const;

protected:
    //==================================================================================
    // protected variables.
    //==================================================================================
    /* NOTHING */

    //==================================================================================
    // protected methods.
    //==================================================================================
    /* NOTHING */

private:
    //==================================================================================
    // private variables.
    //==================================================================================
    u32                 m_NumTriangles;     //!< 三角形数です.
    u32                 m_NumMaterials;     //!< マテリアル数です.
    Triangle*           m_pTriangles;       //!< 三角形リストです.
    IMaterial*          m_pMaterials;       //!< マテリアルリストです.
    IShape*             m_pBVH;             //!< BVHです.

    //==================================================================================
    // private methods.
    //==================================================================================
    Mesh            ( const Mesh& );
    void operator = ( const Mesh& );
};


} // namespace s3d


#endif//__S3D_MESH_H__
